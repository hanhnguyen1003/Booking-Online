@model Patients
@{
    Layout = null;
}
<head>
    <meta charset="utf-8">
    <title>Doccure</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
    <!-- Favicons -->
    <link href="/doc_assets/img/favicon.png" rel="icon">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/doc_assets/css/bootstrap.min.css">

    <!-- Fontawesome CSS -->
    <link rel="stylesheet" href="/doc_assets/plugins/fontawesome/css/fontawesome.min.css">
    <link rel="stylesheet" href="/doc_assets/plugins/fontawesome/css/all.min.css">
    <link rel="stylesheet" href="/doc_assets/css/style.css">
    <link href="~/specialist/plugins/fullcalendar/fullcalendar.min.css" rel="stylesheet" />

    <style>

        .type.dropdown-toggle.nav-link {
            border: 1px solid;
            background: #fff;
            border-color: #307be7;
            border-radius: 99px;
            color: #307be7 !important;
            min-width: 125px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            letter-spacing: 0;
            min-height: 38px;
            font-weight: 600;
            transition: all 0.2s linear;
        }

        .action-logout {
            background-color: #f7f8f9;
            color: #333 !important;
        }

            .action-logout .text-logout-bt {
                color: #333 !important;
                display: block;
                padding: 10px 0px 8px 10px !important;
            }


        .row {
            display: flex;
            flex-wrap: wrap;
            margin-right: -15px;
            margin-left: -15px;
        }


        .btn--rounded-gray {
            background: transparent;
            border: 1px solid #9ba1af !important;
            color: #7a8188 !important;
            width: 100%;
            font-weight: 700;
            transition: all 0.3s;
            position: relative;
        }

        .btn--rounded-blue {
            background: #307be7;
            border: 1px solid #307be7 !important;
            color: #fff !important;
            width: 100%;
            font-weight: 700;
            transition: all 0.3s;
            position: relative;
        }

        .btn {
            display: inline-block;
            text-decoration: none;
            text-transform: uppercase;
            text-align: center;
            font-size: 14px;
            border-radius: 2px;
            margin-right: 10px;
        }

        .card-body {
            position: relative
        }


        .btn--sm {
            padding: 0.525rem 1.125rem 0.425rem;
            line-height: 1.5;
        }


        .btn.btn-outline-primary {
            display: inline-block;
            text-decoration: none;
            text-transform: none;
            text-align: center;
            font-size: 12px;
            border-radius: 2px;
        }

        .card {
            display: flex;
            -webkit-box-orient: vertical;
            -webkit-box-direction: normal;
            flex-direction: column;
            min-width: 0;
            word-wrap: break-word;
            background-color: #fff;
            background-clip: border-box;
        }

        .font-weight-bold {
            font-weight: 700 !important;
        }

        hr {
            box-sizing: content-box;
            height: 0;
            overflow: visible;
        }

        .booking-left-menu .booking-left-menu-top {
            border: 1px solid #cdd8ea;
            border-radius: 3px;
            padding: 15px;
            background: #fff;
            margin-bottom: 20px;
        }

        .booking-left-menu .booking-left-menu-top {
            margin-bottom: 20px;
            border-width: 1px;
            border-style: solid;
            border-color: rgb(205, 216, 234);
            border-image: initial;
            border-radius: 3px;
            padding: 15px;
            background: rgb(255, 255, 255);
        }

            .booking-left-menu .booking-left-menu-top .blmt-name {
                text-transform: uppercase;
                font-size: 14px;
                font-weight: bold;
                color: rgb(77, 77, 77);
                margin-bottom: 10px;
            }

            .booking-left-menu .booking-left-menu-top .blmt-info {
                font-size: 14px;
                margin-bottom: 5px;
                color: rgb(77, 77, 77);
                text-transform: capitalize;
            }

        li {
            list-style-type: none;
        }

        .booking-left-menu-hotline {
            margin-top: 20px;
            border-width: 1px;
            border-style: solid;
            border-color: rgb(205, 216, 234);
            border-image: initial;
            background: rgb(255, 255, 255);
            border-radius: 3px;
            padding: 20px;
        }

            .booking-left-menu-hotline .blmh-name {
                color: rgb(77, 77, 77);
                font-size: 12px;
                font-weight: bold;
                margin-bottom: 5px;
                text-transform: uppercase;
            }

            .booking-left-menu-hotline a {
                font-size: 30px;
                color: rgb(48, 123, 231);
                font-weight: bold;
                letter-spacing: 5px;
                transition: all 0.2s ease 0s;
            }

        .col-lg-9 {
            flex: 0 0 75%;
            max-width: 105%;
        }

        .booking-right-bill {
            background: #fff;
            height: auto;
            transition: all .2s ease;
            margin: 20px 0;
            font-family: -apple-system, system-ui, BlinkMacSystemFont, "Nunito", Arial, "Helvetica Neue", Helvetica, serif, sans-serif;
        }

            .booking-right-bill h4 {
                color: #307be7;
                font-weight: bold;
                font-size: 15px;
                padding: 0 0 20px;
                margin-bottom: 20px;
                border-bottom: 1px solid #cdd8ea;
            }

            .booking-right-bill .brb-bill {
                border: 5px solid #cdd8ea;
                padding: 15px;
            }

        .brb-bill .brb-bill-sub-title {
            font-size: 15px;
            color: #4d4d4d;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .brb-bill .brb-bill-sub-title-1 {
            font-size: 18px;
            color: #4d4d4d;
            margin-bottom: 15px;
        }

        .brb-bill p {
            font-size: 14px;
            color: #4d4d4d;
            margin-bottom: 10px;
        }

        .brb-bill h6 {
            color: #4d4d4d;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .brb-bill .brb-bill-number {
            font-size: 50px;
            color: #307be7;
            font-weight: bold;
            margin: 20px 0 0px;
            line-height: 1.2em;
        }

        .brb-bill p span {
            font-weight: bold;
            color: #4d4d4d;
        }

        .format_barcode > svg {
            max-width: 100%;
            overflow: auto;
        }

        svg:not(:root) {
            vertical-align: middle;
        }

        .btn:not(:disabled):not(.disabled) {
            cursor: pointer;
        }

        .med_blue {
            color: #307be7 !important;
        }

        .mt-4 {
            margin-top: 1.5rem !important;
        }

        .mb-2 {
            margin-bottom: .5rem !important;
        }

        .mb-3 {
            margin-bottom: 1rem !important;
        }

        .brb-btn {
            border-top: 1px solid #cdd8ea;
            padding: 30px 35px;
        }

            .brb-btn .btn.btn-success {
                background: #38d46a;
                padding: 10px 42px;
                color: #fff;
                border: none;
                text-transform: uppercase;
                margin-top: 30px;
            }

        .table-striped th {
            text-align: center
        }

        h5.modal-title.text-uppercase {
            font-family: "Segoe UI","Segoe UI Emoji";
        }
        @@media only print{

          /*  html, body * {
                visibility: hidden;              
            }*/
           /* #bill, #bill * {
                visibility: visible;                
            }
            #bill {
                page-break-before: avoid !important;
                page-break-after: avoid !important;
                page-break-inside: avoid !important;
                position: absolute ;
                left: 0 !important;
                top: 0 !important;
                orphans: unset;
                widows: unset;
                overflow: hidden;
            }*/
        }
        @@page{
            size:auto;
        }
        #voucher{
            max-width:80mm;
        }
    </style>
</head>
<body class="">

    <!-- Main Wrapper -->
    <div class="main-wrapper d-print-none">
        <!-- Header -->
        <header class="header">
            <nav class="navbar navbar-expand-lg header-nav">
                <div class="navbar-header">
                    <a id="mobile_btn" href="javascript:void(0);">
                        <span class="bar-icon">
                            <span></span>
                            <span></span>
                            <span></span>
                        </span>
                    </a>
                    <a href="index-2.html" class="navbar-brand logo">
                        <img src="/specialist/img/logo.png" class="img-fluid" alt="Logo">
                    </a>
                </div>
                <div class="main-menu-wrapper">
                    <div class="menu-header">
                        <a href="index-2.html" class="menu-logo">
                            <img src="/specialist/img/logo.png" class="img-fluid" alt="Logo">
                        </a>
                        <a id="menu_close" class="menu-close" href="javascript:void(0);">
                            <i class="fas fa-times"></i>
                        </a>
                    </div>
                    <ul class="main-nav">
                        <li class="has-submenu">
                            <a href="/">Trang chủ</a>
                        </li>
                        <li class="has-submenu">
                            <a href="/Home/Intro">Giới thiệu</a>
                        </li>
                        <li class="has-submenu">
                            <a href="/Home/Quytrinh">Quy trình</a>
                        </li>
                        <li class="has-submenu">
                            <a href="/Home/Help">Hướng dẫn sử dụng</a>
                        </li>
                        <li class="has-submenu">
                            <a href="/Home/Contact">Liên hệ</a>
                        </li>
                    </ul>
                </div>
                <ul class="nav header-navbar-rht">
                    <li class="nav-item contact-item">
                        <div class="header-contact-img">
                            <i class="far fa-hospital"></i>
                        </div>
                        <div class="header-contact-detail">
                            <p class="contact-header">Liên hệ</p>
                            <p class="contact-info-header">0977129155</p>
                        </div>
                    </li>

                    @if (User.Identity.IsAuthenticated)
                    {
                        <li class="nav-item dropdown has-arrow">
                            <a href="#" class="dropdown-toggle nav-link" data-toggle="dropdown">
                                <span><i class="fas fa-user-circle mr-2"></i>Thông tin tài khoản</span><span class="user-img"></span>
                            </a>
                            <div class="dropdown-menu">
                                <div class="user-header">
                                    <div class="avatar avatar-sm">
                                        <img src="~/doc_assets/img/patients/user.svg" alt="User Image" class="avatar-img rounded-circle">
                                    </div>
                                    <div class="user-text">
                                        <h6>Xin chào!</h6>
                                        <p class="text-muted mb-0">@User.Identity.Name</p>
                                    </div>
                                </div>
                                <a class="dropdown-item" href="/Patient/Patients/ProfilePatient">Hồ sơ bệnh nhân</a>
                                <a class="dropdown-item" href="/Patient/Patients/ManageMB/@User.Identity.Name">Phiếu khám bệnh</a>
                                <div class="action-logout">
                                    <a class="text-logout-bt" href="/Users/Auth/SignOut">
                                        <i class="fas fa-sign-out-alt mr-2"></i>Thoát
                                    </a>
                                </div>
                            </div>
                        </li>
                        @if (User.IsInRole("Patient"))
                        {

                        }
                    }
                    else
                    {
                        <li class="nav-item">
                            <a class="nav-link header-login" href="/Users/Auth/SignIn">Đăng nhập</a>
                        </li>
                    }
                </ul>
            </nav>
        </header>
        <!-- /Header -->
        <!-- Breadcrumb -->
        <div class="breadcrumb-bar">
            <div class="container-fluid">
                <div class="row align-items-center">
                    <div class="col-md-8 col-12">
                        <nav aria-label="breadcrumb" class="page-breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="index-2.html">Trang chủ</a></li>
                                <li class="breadcrumb-item active" aria-current="page">Đặt khám</li>
                            </ol>
                        </nav>
                        <h3 class="breadcrumb-title">Phiếu khám bệnh</h3>
                    </div>
                    <div class="col-md-4 col-12 d-md-block d-none">
                        <div class="sort-by">
                            <ul style="list-style:none">
                                <li class="nav-item dropdown has-arrow" style="list-style:none">
                                    <a href="#" class="type dropdown-toggle nav-link text-uppercase" data-toggle="dropdown">
                                        <span>Chọn hình thức đăng ký</span><span class="user-img"></span>
                                    </a>
                                    <div class="dropdown-menu text-uppercase">
                                        <a class="dropdown-item" href="/Patient/Home/BookingByDoctor">Đặt lịch theo bác sĩ</a>
                                        <hr />
                                        <a class="dropdown-item" href="/Patient/Home/BookingByDay">Đặt lịch theo ngày</a>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Breadcrumb -->
        <!-- Page Content -->
        <div class="content">
            <div class="container-fluid" style="min-height:600px">
                <div class="row">
                    <div class="col-md-4 col-lg-3 theiaStickySidebar">
                        <div class="booking-left-menu shadow-2">
                            <div class="booking-left-menu-top shadow-2" id="patientDetail">
                            </div>
                            <div class="booking-left-menu-hotline text-center shadow-2">
                                <div class="blmh-name">Hỗ trợ chuyên môn</div>
                                <a href="tel:19007178" class="d-block">19007178</a>
                                <hr>
                                <div class="blmh-name">Hỗ trợ kỹ thuật</div>
                                <a href="tel:19002115" class="d-block">19002115</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12 col-lg-9">
                        <div class="card">
                            <div class="card-body">
                                <div class="col-md-8 col-lg-9 order-1 order-md-2">
                                    <div class="booking-right-bill">
                                        <h4>THÔNG TIN PHIẾU KHÁM BỆNH</h4>
                                        <div class="row" id="departdetail">
                                        </div>
                                        <div class="brb-btn">
                                            <p>Phiếu khám bệnh của bệnh nhân sẽ được lưu trữ tại hệ thống. Để tiện việc theo dõi, và lấy lại phiếu khám.</p><p class="mg-bottom-2">Bệnh nhân vào mục (Thông tin bệnh nhân)</p>
                                            <div class="text-center">
                                                <a class="btn btn-success" href="/">Quay về trang chủ</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /Page Content -->
            <!-- Footer -->
            <footer class="footer">
                <div class="footer-top">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-lg-2 col-md-3">
                            </div>
                            <div class="col-lg-3 col-md-6">
                                <div class="footer-widget footer-about">
                                    <div class="footer-logo">
                                        <img src="/doc_assets/img/footer-logo.png" alt="logo">
                                    </div>
                                    <div class="footer-about-content">
                                        <p>Doccure có đội ngũ chuyên gia, bác sĩ, dược sĩ và điều dưỡng trình độ chuyên môn cao, giàu kinh nghiệm. tận tâm và chuyên nghiệp. Luôn đặt người bệnh làm trung tâm, Doccure cam kết đem đến dịch vụ chăm sóc sức khỏe tốt nhất.</p>
                                        <div class="social-icon">
                                            <ul>
                                                <li>
                                                    <a href="#" target="_blank"><i class="fab fa-facebook-f"></i> </a>
                                                </li>
                                                <li>
                                                    <a href="#" target="_blank"><i class="fab fa-twitter"></i> </a>
                                                </li>
                                                <li>
                                                    <a href="#" target="_blank"><i class="fab fa-linkedin-in"></i></a>
                                                </li>
                                                <li>
                                                    <a href="#" target="_blank"><i class="fab fa-instagram"></i></a>
                                                </li>
                                                <li>
                                                    <a href="#" target="_blank"><i class="fab fa-dribbble"></i> </a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-1">
                            </div>
                            <div class="col-lg-4 col-md-12">
                                <div class="footer-widget footer-contact">
                                    <h2 class="footer-title">Liên hệ</h2>
                                    <div class="footer-contact-info">
                                        <div class="footer-address">
                                            <span><i class="fas fa-map-marker-alt"></i></span>
                                            <p> 437c/4 Long Hòa, Bình Thủy, Cần Thơ</p>
                                        </div>
                                        <p>
                                            <i class="fas fa-phone-alt"></i>
                                            0977129155
                                        </p>
                                        <p class="mb-0">
                                            <i class="fas fa-envelope"></i>
                                            doccure@gmail.com
                                        </p>
                                    </div>
                                </div>

                            </div>
                            <div class="col-lg-2 col-md-3 ">
                            </div>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
    </div>
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-uppercase"><i class="far fa-bell"></i> Chọn số điện thoại nhận tin</h5>
                </div>
                <div class="modal-body">
                    <div class="form-check">
                        <input class="form-check-input"  onchange="exampleRadiosChange(this)" type="radio" name="exampleRadios" id="exampleRadios1" value="@User.Identity.Name">
                        <label class="form-check-label" for="exampleRadios1">@User.Identity.Name</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input"  onchange="exampleRadiosChange(this)" type="radio" name="exampleRadios" id="exampleRadios2" value="@Model.SubPhone">
                        <label class="form-check-label" for="exampleRadios2">@Model.SubPhone</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="exampleRadios" id="exampleRadios3" value="3" onchange="exampleRadiosChange(this)">
                        <label class="form-check-label" for="exampleRadios3">Số điện thoại khác</label>
                        <input class="form-control d-none" type="text" placeholder="Nhập số điện thoại khác" id="diffPhoneInput"/>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="sendSMS()">GỬI</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">ĐÓNG</button>
                </div>
            </div>
        </div>
    </div>
    <div id="voucher" class="d-none brb-bill"></div>
    <script src="/doc_assets/js/jquery.min.js"></script>
    <script src="~/assets/js/JsBarcode.code128.min.js"></script>
    <script>
        var j = jQuery.noConflict();
        var PKB = null;
        j(document).ready(() => {
            PKB = JSON.parse(localStorage.getItem('PKB'));
            showInfo(PKB);
        })
        function sendSMS() {
            var valueOption = j("input:radio[name=exampleRadios]:checked").val();
            let phone = '';
            if (valueOption == 3) {
                phone = document.getElementById('diffPhoneInput').value;
            } else {
                phone = valueOption;
            }
            let obj = JSON.parse(localStorage.getItem('PKB'))[0];
            let cdnmoment = '<'
            console.log(phone)
            var canvas = document.createElement('canvas');
            JsBarcode(canvas, obj.idPatient, {
                width: 1,
                height: 100,
                fontSize: 20,
                margin: 1,
                textMargin: 0
            })
            var data = canvas.toDataURL("image/jpeg")
            console.log(data)
            let voucher = `<!DOCTYPE html>
                                <html><head>
                                        <meta charset="utf-8">
                                            <title>Doccure</title>
                                            <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">

                                            <!-- Favicons -->
                                            <link href="/doc_assets/img/favicon.png" rel="icon">

                                            <!-- Bootstrap CSS -->
                                           <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"/>
                                                <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/locale/ar-kw.min.js" integrity="sha512-FbWEYMNShc1lJVeXDQNtpStnX336hcI3VAatMSsFZQXIV74NJseKcjrnTnl1kC9VgkORIAzgmm42P0wKTCja6w==" crossorigin="anonymous" referrerpolicy="no-referrer">${cdnmoment}/script>
                                          
                                <style>
                                    .row {
                                        display: flex;
                                        flex-wrap: wrap;
                                        margin-right: -15px;
                                        margin-left: -15px;
                                    }

                                    hr {
                                        box-sizing: content-box;
                                        height: 0;
                                        overflow: visible;
                                    }

                                    li {
                                        list-style-type: none;
                                    }

                                    .booking-right-bill {
                                        border: 1px solid #cdd8ea;
                                        background: #fff;
                                        border-radius: 3px;
                                        padding: 30px;
                                        height: auto;
                                        transition: all .2s ease;
                                        margin: 20px 0;
                                        font-family: -apple-system, system-ui, BlinkMacSystemFont, "Nunito", Arial, "Helvetica Neue", Helvetica, serif, sans-serif;
                                    }

                                        .booking-right-bill h4 {
                                            color: #307be7;
                                            font-weight: bold;
                                            font-size: 15px;
                                            padding: 0 0 20px;
                                            margin-bottom: 20px;
                                            border-bottom: 1px solid #cdd8ea;
                                        }

                                        .booking-right-bill .brb-bill {
                                            border: 5px solid #cdd8ea;
                                            padding: 15px;
                                        }

                                    .brb-bill-sub-title {
                                        font-size: 15px;
                                        color: #4d4d4d;
                                        margin-bottom: 20px;
                                        font-weight: bold;
                                        text-align:center;
                                    }

                                    .brb-bill-sub-title-1 {
                                        font-size: 18px;
                                        color: #4d4d4d;
                                        margin-bottom: 15px;
                                        text-align:center;
                                    }

                                    .brb-bill p {
                                        font-size: 14px;
                                        color: #4d4d4d;
                                        margin-bottom: 10px;
                                    }

                                    .brb-bill h6 {
                                        color: #4d4d4d;
                                        font-size: 14px;
                                        margin-bottom: 5px;
                                        text-align:center;
                                    }

                                    .brb-bill-number {
                                        font-size: 100px;
                                        color: #307be7;
                                        font-weight: bold;
                                        margin: 20px 0 0px;
                                        line-height: 1.2em;
                                        text-align:center;
                                    }

                                    .brb-bill p span {
                                        font-weight: bold;
                                        color: #4d4d4d;
                                    }

                                    .format_barcode > svg {
                                        max-width: 100%;
                                        overflow: auto;
                                    }

                                    svg:not(:root) {
                                        vertical-align: middle;
                                    }

                                    .btn:not(:disabled):not(.disabled) {
                                        cursor: pointer;
                                    }

                                    .med_blue {
                                        color: #307be7 !important;
                                    }

                                    .mt-4 {
                                        margin-top: 1.5rem !important;
                                    }

                                    .mb-2 {
                                        margin-bottom: .5rem !important;
                                    }

                                    .mb-3 {
                                        margin-bottom: 1rem !important;
                                    }

                                    .format_barcode > svg {
                                        max-width: 100%;
                                        overflow: auto;
                                        text-align:center;

                                    }
                                    .format_barcode {
                                        text-align:center;

                                    }

                                    svg:not(:root) {
                                        vertical-align: middle;
                                    }
                            </style>
                        </head>
                        <body><div class="main-wrapper">
                                <div class="container">
                                    <div class="row">
                                        <div class="col-md-12 col-lg-12">
                                            <div class="booking-right-bill">
                                                <div class="row">
                                                    <div class="col-md-10 mx-auto">
                                                        <div class="row">
                                                            <div class="col-md-6 brb-bill-hide brb-bill-hide-1 show">
                                                                <div class="brb-bill">
                                                                    <div class="brb-bill-sub-title text-center">Bệnh viện TẬN TÂM</div>
                                                                    <div class="brb-bill-sub-title-1 text-center"><b>PHIẾU KHÁM BỆNH</b><p>(Mã phiếu: ${obj.idPKB})</p></div>
                                                                    <h6 class="text-center" id="bill-6-phongkham">Phòng khám: ${obj.roomName}</h6>
                                                                    <h6 class="text-center">Chuyên khoa: <span id="bill-6-khoa">${obj.deptName}</span></h6>
                                                                    <div class="brb-bill-number text-center ">${obj.sttPatient}</div>
                                                                    <p>Ngày khám: <span>${moment(obj.dated).format("DD/MM/YYYY")}</span> (<span id="bill-6-buoi" class="capital">${obj.ses}</span>)</p>
                                                                    <p>Giờ khám: <span id="bill-6-giokham">${obj.rangeTime}</span></p>
                                                                    <p>Họ tên: <span class="bill-6-name">${obj.namePatient}</span></p>
                                                                    <p>Giới tính: <span class="bill-6-gioitinh">${obj.sexP?"Nam":"Nữ"}</span></p>
                                                                    <p>Năm sinh: <span class="bill-6-year"${moment(obj.dob).format("DD/MM/YYYY")}</span></p>
                                                                    <p>Địa chỉ: <span class="bill-6-city">${obj.addP}</span></p>
                                                                    <p><i>Vui lòng đến trực tiếp phòng khám trước giờ hẹn 15-30 phút để khám bệnh.</i></p>
                                                                    <p>Tiền khám: <b>${obj.price} đồng</b></p>
                                                                    <p></p>
                                                                    <hr>
                                                                    <p>Số hồ sơ (Mã số bệnh nhân):<br><span class="bill-6-code"></span>${obj.idPatient}</p>
                                                                    <div class="format_barcode">
                                                                    <img width="250px" height="121px" src="cid:hinhmavach"/>
                                                                    </div><br>
                                                                    <p><i>Ghi chú: Phiếu khám bệnh chỉ có giá trị trong ngày khám từ <b>6h30 - 16h30</b></i></p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div></body></html>`;
            j.post('/Patient/patients/SendSMS', { obj: obj, phone: phone, voucher: voucher, dataurl: data.replace('data:image/jpeg;base64,','')}, (d) => {
                console.log(d);
                j("#exampleModal").modal('hide');

            })
        }
        function exampleRadiosChange(e) {
            if (e.value==3) {
                document.getElementById('diffPhoneInput').classList.remove('d-none')
            } else {
                document.getElementById('diffPhoneInput').classList.add('d-none')

            }
        }

        function showInfo(PKB) {
            let strpatient = '';
            let strdepart = '';
            //let stt = '';
            //let deptstr = '';

            if (PKB.length > 0) {
                strpatient =
                    `<div class="blmt-name">
                                                <div class="nav-title-name">${PKB[0].namePatient}</div>
                                                </div>
                                               <div class="blmt-info">Địa chỉ: ${PKB[0].addP}</div>`

            } else {
                strpatient = "Không có thông tin bệnh nhân";
            }
            //for (let item of PKB) {
            //    stt += `<td class="brb-bill-number text-center">${item.sttPatient}</td>`;
            //    deptstr += `<td><h6>Phòng khám:${item.roomName}</h6>
            //                <h6>Chuyên khoa:<span id="bill-6-khoa">${item.deptName}</span></h6>
            //                <p>Ngày khám:
            //                <span>${moment(item.dated).format('DD-MM-YYYY')} -</span>
            //                <span id="bill-6-buoi" style="text-transform: capitalize; font-style: italic; font-size: 14px;">Buổi ${item.ses}</span>
            //                </p>
            //                <p>Giờ khám dự kiến: <span id="bill-6-giokham">${item.rangeTime}</span></p>
            //                <p class="">Tiền khám:<b>${item.price.toLocaleString(undefined, { maximumFractionDigits: 0 })} đồng</b></p>
            //            </td>`;
            //}
            //console.log(deptstr)
            if (PKB.length > 0) {
                strdepart = PKB.map((item, index) => {
                    return `<div class="col-md-12 ">
                                        <div class="row">
                                            <div class="col-md-6 brb-bill-hide brb-bill-hide-1 show">
                                                <div class="brb-bill voucher">
                                                    <div class="brb-bill-sub-title text-center">
                                                        <b>BỆNH VIỆN TẬN TÂM</b>
                                                    </div>
                                                    <div class="brb-bill-sub-title-1 text-center">
                                                        <b>PHIẾU KHÁM BỆNH</b>
                                                        <p>(Mã phiếu: ${PKB[0].idPKB})</p>
                                                    </div>
                                                    <h6 class="text-center" id="bill-6-phongkham">Phòng khám: ${item.roomName}</h6>
                                                    <h6 class="text-center">Chuyên khoa: <span id="bill-6-khoa">${item.deptName}</span></h6>
                                                    <div class="brb-bill-number text-center ">${item.sttPatient}</div>
                                                    <p>Ngày khám: <span>${moment(item.dated).format('DD-MM-YYYY')}</span> (<span id="bill-6-buoi" class="capital">Buổi ${item.ses}</span>)</p>
                                                    <p>Giờ khám dự kiến: <span id="bill-6-giokham">${item.rangeTime}</span></p>
                                                    <p>Họ tên: <span class="bill-6-name">${PKB[0].namePatient}</span></p>
                                                    <p>
                                                        Giới tính:
                                                        <span class="bill-6-gioitinh">${PKB[0].sexP == true ? "Nữ" : "Nam"}</span>
                                                    </p>
                                                    <p>
                                                        Năm sinh:
                                                        <span class="bill-6-year">${moment(PKB[0].DOB).format('DD-MM-YYYY')}</span>
                                                    </p>
                                                    <p>
                                                        Địa chỉ:
                                                        <span class="bill-6-city">${PKB[0].addP}</span>
                                                    </p>

                                                    <p>
                                                        <em>Vui lòng đến trực tiếp phòng khám trước giờ hẹn 15-30 phút để khám bệnh.</em>
                                                    </p>
                                                    <p>Tiền khám: <b>${item.price.toLocaleString(undefined, { maximumFractionDigits: 0 })} đồng</b></p>
                                                    <hr>
                                                    <p>
                                                        Số hồ sơ (Mã số bệnh nhân):
                                                        <br>
                                                        <span class="bill-6-code"></span>
                                                    </p>
                                                    <div class="format_barcode text-center">
                                                        <svg width="450px" height="147px" name="barcode" x="0px" y="0px" viewBox="0 0 310 147" version="1.1" style="transform: translate(0,0)">
                                                        </svg>
                                                    </div>
                                                    <p>
                                                        <em>
                                                            Ghi chú: Phiếu khám bệnh chỉ có giá trị trong ngày từ <b>6h30 - 16h30</b>
                                                        </em>
                                                    </p>
                                                </div>
                                                <div class="btn btn--rounded-gray med_blue mt-4 mb-2" onclick="showModal()">Gửi tin nhắn</div>
                                                <div class="btn btn--rounded-gray med_blue mb-3" onclick="InPhieuKham(${index})"><i class="fas fa-print mr-2" ></i>In phiếu khám bệnh</div>

                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                </div>`}).toString()

            }
            else {
                strdepart = "Không có thông tin khoa khám";
                strpatient = "Không có thông tin bệnh nhân";
            }

            document.getElementById('patientDetail').innerHTML = strpatient.replaceAll('>,<', '><');
            document.getElementById('departdetail').innerHTML = strdepart.replaceAll('>,<', '><');
            let bc = document.getElementsByName("barcode")
            for (let i = 0; i < bc.length; i++) {
                JsBarcode(bc[i], PKB[i].idPatient, {});
                JsBarcode(bc[i], PKB[i].idPatient, {});
            }
        }
        function InPhieuKham(i) {
            let vs = document.getElementsByClassName('voucher');
            let voucher = document.getElementById('voucher')
            voucher.innerHTML = '';
            voucher.classList.remove('d-none')           
            j("#voucher").append(vs[i].innerHTML);
            setTimeout(() => {
                print();
            }, 200);
        }
        window.onafterprint = (event) => {
            let voucher = document.getElementById('voucher');
            voucher.innerHTML = '';
            voucher.classList.add('d-none')
        };
        function showModal() {
            j('#exampleModal').modal('show');
        }
    </script>
    <script src="~/doc_assets/js/moment.min.js"></script>
    <script src="~/doc_assets/js/bootstrap-datetimepicker.min.js"></script>
    <script src="~/doc_assets/js/fullcalendar.min.js"></script>
    <script src="/specialist/js/popper.min.js"></script>
    <script src="/specialist/js/bootstrap.min.js"></script>

    <!-- Sticky Sidebar JS -->
    <script src="/specialist/plugins/theia-sticky-sidebar/ResizeSensor.js"></script>
    <script src="/specialist/plugins/theia-sticky-sidebar/theia-sticky-sidebar.js"></script>
    <!-- Custom JS -->
    <script src="/specialist/js/script.js"></script>

    <!--Bootstrap Core JS-->
    <script src="/specialist/js/popper.min.js"></script>
    <script src="/specialist/js/bootstrap.min.js"></script>

    <!-- Sticky Sidebar JS -->
    <script src="/specialist/plugins/theia-sticky-sidebar/ResizeSensor.js"></script>
    <script src="/specialist/plugins/theia-sticky-sidebar/theia-sticky-sidebar.js"></script>
    <script src="/specialist/js/script.js"></script>

</body>
