@model List<WebApp.Areas.Admin.Models.Department>
<!-- doccure/calendar.html  30 Nov 2019 04:12:18 GMT -->
@{
    Layout = null;
}
<head>
    <meta charset="utf-8">
    <title>Doccure</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">

    <!-- Favicons -->
    <link href="/doc_assets/img/favicon.png" rel="icon">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/doc_assets/css/bootstrap.min.css">

    <!-- Fontawesome CSS -->
    <link rel="stylesheet" href="/doc_assets/plugins/fontawesome/css/fontawesome.min.css">
    <link rel="stylesheet" href="/doc_assets/plugins/fontawesome/css/all.min.css">
    <link rel="stylesheet" href="/doc_assets/css/style.css">
    <link href="~/specialist/plugins/fullcalendar/fullcalendar.min.css" rel="stylesheet" />

    <style>

        .container-fluid {
            padding-left: 20px;
            padding-right: 20px;
        }

        .row {
            display: flex;
            flex-wrap: wrap;
            margin-right: -15px;
            margin-left: -15px;
        }

        .btn--sm {
            padding: 0.525rem 1.125rem 0.425rem;
            line-height: 1.5;
        }

        .btn--rounded-gray {
            background: transparent;
            border: 1px solid #9ba1af !important;
            color: #7a8188 !important;
        }

        .col-lg-6.col-12.ml-auto {
            padding-bottom: 30px
        }

        .btn--rounded-gray {
            width: 100%;
            font-weight: 700;
            transition: all 0.3s;
            position: relative;
        }

        .btn--rounded-blue {
            background: #307be7;
            border: 1px solid #307be7 !important;
            color: #fff !important;
            width: 100%;
            font-weight: 700;
            transition: all 0.3s;
            position: relative;
        }

        .btn {
            display: inline-block;
            text-decoration: none;
            text-transform: uppercase;
            text-align: center;
            font-size: 14px;
            border-radius: 2px;
            margin-right: 10px;
        }

        .booking-left-menu .booking-left-menu-top {
            margin-bottom: 20px;
            border-width: 1px;
            border-style: solid;
            border-color: rgb(205, 216, 234);
            border-image: initial;
            border-radius: 3px;
            padding: 15px;
            background: rgb(255, 255, 255);
        }

            .booking-left-menu .booking-left-menu-top .blmt-name {
                text-transform: uppercase;
                font-size: 14px;
                font-weight: bold;
                color: rgb(77, 77, 77);
                margin-bottom: 10px;
            }

            .booking-left-menu .booking-left-menu-top .blmt-info {
                font-size: 14px;
                margin-bottom: 5px;
                color: rgb(77, 77, 77);
                text-transform: capitalize;
            }

        #section-find-doctor-2 {
            margin-bottom: 20px;
        }

            #section-find-doctor-2 .find-doctor-left-1 {
                border-radius: 3px;
            }

                #section-find-doctor-2 .find-doctor-left-1 h4 {
                    color: rgb(255, 255, 255);
                    font-size: 15px;
                    padding: 15px;
                    border-radius: 3px 3px 0px 0px;
                    margin: 0px;
                    background: linear-gradient(rgb(66, 165, 245) 0px, rgb(33, 150, 243) 100%);
                }

        .find-doctor-left-1 ul {
            padding: 15px;
            border-left: 1px solid rgb(205, 216, 234);
            border-right: 1px solid rgb(205, 216, 234);
            border-bottom: 1px solid rgb(205, 216, 234);
            background: rgb(255, 255, 255);
            border-radius: 0px 0px 3px 3px;
        }

        #section-find-doctor-2 .find-doctor-left-1 ul li:first-child {
            color: rgb(48, 123, 231);
            font-weight: 700;
        }

        #section-find-doctor-2 .find-doctor-left-1 ul li {
            font-size: 13px;
            color: rgb(77, 77, 77);
            margin-bottom: 15px;
        }

            #section-find-doctor-2 .find-doctor-left-1 ul li i {
                margin-right: 15px;
                color: rgb(48, 123, 231);
            }

        li {
            list-style-type: none;
        }

        .booking-left-menu-hotline {
            margin-top: 20px;
            border-width: 1px;
            border-style: solid;
            border-color: rgb(205, 216, 234);
            border-image: initial;
            background: rgb(255, 255, 255);
            border-radius: 3px;
            padding: 20px;
        }

            .booking-left-menu-hotline .blmh-name {
                color: rgb(77, 77, 77);
                font-size: 12px;
                font-weight: bold;
                margin-bottom: 5px;
                text-transform: uppercase;
            }

            .booking-left-menu-hotline a {
                font-size: 30px;
                color: rgb(48, 123, 231);
                font-weight: bold;
                letter-spacing: 5px;
                transition: all 0.2s ease 0s;
            }

        .brt-cont-group {
            height: auto;
            transition: all .2s ease;
            border: 1px solid #cdd8ea;
            border-radius: 2px;
            margin-bottom: 30px;
        }

            .brt-cont-group .brt-cont {
                padding: 20px;
                padding-right: 35px;
                position: relative;
                cursor: pointer;
                padding-bottom: 20px;
                transition: all .2s ease;
            }

        .align-items-center {
            -webkit-box-align: center !important;
            align-items: center !important;
        }

        .d-flex {
            display: flex !important;
        }

        .brt-cont-group .brt-cont i {
            position: absolute;
            top: 20px;
            right: 23px;
            transition: all .2s ease;
            transform: rotate( 270deg);
            color: #696969;
        }

        .brt-cont-group.active .brt-cont i {
            transform: rotate( 90deg);
        }

        .brt-cont-group.active .brt-cont i {
            color: #307be7;
            transition: all .2s ease;
        }

        .brt-cont-group .brt-cont i {
            position: absolute;
            top: 20px;
            right: 23px;
        }

        .brt-cont-group .brt-cont span {
            font-size: 35px;
            color: #696969;
            transition: all .2s ease;
        }

        .fa-user-md:before {
            content: "\f0f0";
        }

        .brt-cont-group .brt-cont .brt-cont-right {
            margin-left: 15px;
        }

            .brt-cont-group .brt-cont .brt-cont-right .brt-cont-name {
                font-size: 13px;
                color: #4d4d4d;
                font-weight: bold;
                margin-bottom: 5px;
            }

            .brt-cont-group .brt-cont .brt-cont-right .brt-cont-code {
                font-size: 12px;
                color: #696969;
            }

        .brt-cont-hide ul {
            display: flex;
            justify-content: flex-start;
        }

        .type.dropdown-toggle.nav-link {
            border: 1px solid;
            background: #fff;
            border-color: #307be7;
            border-radius: 99px;
            color: #307be7 !important;
            min-width: 125px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            letter-spacing: 0;
            min-height: 38px;
            font-weight: 600;
            transition: all 0.2s linear;
        }
    </style>
</head>
<body>

    <!-- Main Wrapper -->
    <div class="main-wrapper">

        <!-- Header -->
        <header class="header">
            <nav class="navbar navbar-expand-lg header-nav">
                <div class="navbar-header">
                    <a id="mobile_btn" href="javascript:void(0);">
                        <span class="bar-icon">
                            <span></span>
                            <span></span>
                            <span></span>
                        </span>
                    </a>
                    <a href="index-2.html" class="navbar-brand logo">
                        <img src="/specialist/img/logo.png" class="img-fluid" alt="Logo">
                    </a>
                </div>
                <div class="main-menu-wrapper">
                    <div class="menu-header">
                        <a href="index-2.html" class="menu-logo">
                            <img src="/specialist/img/logo.png" class="img-fluid" alt="Logo">
                        </a>
                        <a id="menu_close" class="menu-close" href="javascript:void(0);">
                            <i class="fas fa-times"></i>
                        </a>
                    </div>
                    <ul class="main-nav">
                        <li class="has-submenu">
                            <a href="/">Trang chủ</a>
                        </li>
                        <li class="has-submenu">
                            <a href="/Home/Intro">Giới thiệu</a>
                        </li>
                        <li class="has-submenu">
                            <a href="/Home/Quytrinh">Quy trình</a>
                        </li>
                        <li class="has-submenu">
                            <a href="/Home/Help">Hướng dẫn sử dụng</a>
                        </li>
                        <li class="has-submenu">
                            <a href="/Home/Contact">Liên hệ</a>
                        </li>
                    </ul>
                </div>
                <ul class="nav header-navbar-rht">
                    <li class="nav-item contact-item">
                        <div class="header-contact-img">
                            <i class="far fa-hospital"></i>
                        </div>
                        <div class="header-contact-detail">
                            <p class="contact-header">Liên hệ</p>
                            <p class="contact-info-header">0977129155</p>
                        </div>
                    </li>

                    @if (User.Identity.IsAuthenticated)
                    {
                        <li class="nav-item dropdown has-arrow">
                            <a href="#" class="dropdown-toggle nav-link" data-toggle="dropdown">
                                <span><i class="fas fa-user-circle mr-2"></i>Thông tin tài khoản</span><span class="user-img"></span>
                            </a>
                            <div class="dropdown-menu">
                                <div class="user-header">
                                    <div class="avatar avatar-sm">
                                        <img src="~/doc_assets/img/patients/user.svg" alt="User Image" class="avatar-img rounded-circle">
                                    </div>
                                    <div class="user-text">
                                        <h6>Xin chào!</h6>
                                        <p class="text-muted mb-0">@User.Identity.Name</p>
                                    </div>
                                </div>
                                <a class="dropdown-item" href="/Patient/Patients/ProfilePatient">Hồ sơ bệnh nhân</a>
                                <a class="dropdown-item" href="/Patient/Patients/ManageMB/@User.Identity.Name">Phiếu khám bệnh</a>
                                <div class="action-logout">
                                    <a class="text-logout-bt" href="/Users/Auth/SignOut">
                                        <i class="fas fa-sign-out-alt mr-2"></i>Thoát
                                    </a>
                                </div>
                            </div>
                        </li>
                        @if (User.IsInRole("Patient"))
                        {

                        }
                    }
                    else
                    {
                        <li class="nav-item">
                            <a class="nav-link header-login" href="/Users/Auth/SignIn">Đăng nhập</a>
                        </li>
                    }
                </ul>
            </nav>
        </header>
        <!-- /Header -->
        <!-- Breadcrumb -->
        <div class="breadcrumb-bar">
            <div class="container-fluid">
                <div class="row align-items-center">
                    <div class="col-md-8 col-12">
                        <nav aria-label="breadcrumb" class="page-breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="index-2.html">Trang chủ</a></li>
                                <li class="breadcrumb-item active" aria-current="page">Khám theo ngày</li>
                            </ol>
                        </nav>
                        <h3 class="breadcrumb-title">Đặt khám</h3>
                    </div>
                    <div class="col-md-4 col-12 d-md-block d-none">
                        <div class="sort-by">
                            <ul style="list-style:none">
                                <li class="nav-item dropdown has-arrow" style="list-style:none">
                                    <a href="#" class="type dropdown-toggle nav-link text-uppercase" data-toggle="dropdown">
                                        <span>Chọn hình thức đăng ký</span><span class="user-img"></span>
                                    </a>
                                    <div class="dropdown-menu text-uppercase">
                                        <a class="dropdown-item" href="/Patient/Home/BookingByDoctor">Đặt lịch theo bác sĩ</a>
                                        <hr />
                                        <a class="dropdown-item" href="/Patient/Home/BookingByDay">Đặt lịch theo ngày</a>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Breadcrumb -->
        <!-- Page Content -->
        <div class="content">
            <div class="container-fluid">

                <div class="row">

                    <!-- Calendar Events -->
                    <div class="col-md-4 col-lg-3 theiaStickySidebar">
                        <!-- Profile Sidebar -->
                        <div class="booking-left-menu shadow-2">
                            <div class="booking-left-menu-top shadow-2" id="patientDetail">

                            </div>
                            <div id="section-find-doctor-2">
                                <div class="find-doctor-left-1 shadow-2" id="doctorDetail">

                                </div>
                            </div>
                            <div class="booking-left-menu-hotline text-center shadow-2">
                                <div class="blmh-name">Hỗ trợ chuyên môn</div>
                                <a href="tel:19007178" class="d-block">19007178</a>
                                <hr>
                                <div class="blmh-name">Hỗ trợ kỹ thuật</div>
                                <a href="tel:19002115" class="d-block">19002115</a>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-8 col-lg-9">
                        <div class="card">
                            <div class="card-body" id="accordionExample">

                            </div>
                            <hr />
                            <div id="confirm-thong-tin" class="brc-btn row align-items-center text-center show">
                                <div class="col-lg-6 col-12 ml-auto">
                                    <div class="row">
                                        <div class="col-5">
                                            <a class="btn btn--rounded-gray btn--sm" href="/Patient/Home/BookingByDay">QUAY LẠI</a>
                                        </div>
                                        <div class="col-5">
                                            <a class="btn btn--rounded-blue btn--sm" onclick="next()">TIẾP TỤC</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <!-- /Page Content -->
        <!-- Footer -->
        <footer class="footer">

            <!-- Footer Top -->
            <div class="footer-top">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-lg-2 col-md-3">
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <div class="footer-widget footer-about">
                                <div class="footer-logo">
                                    <img src="/doc_assets/img/footer-logo.png" alt="logo">
                                </div>
                                <div class="footer-about-content">
                                    <p>Doccure có đội ngũ chuyên gia, bác sĩ, dược sĩ và điều dưỡng trình độ chuyên môn cao, giàu kinh nghiệm. tận tâm và chuyên nghiệp. Luôn đặt người bệnh làm trung tâm, Doccure cam kết đem đến dịch vụ chăm sóc sức khỏe tốt nhất.</p>
                                    <div class="social-icon">
                                        <ul>
                                            <li>
                                                <a href="#" target="_blank"><i class="fab fa-facebook-f"></i> </a>
                                            </li>
                                            <li>
                                                <a href="#" target="_blank"><i class="fab fa-twitter"></i> </a>
                                            </li>
                                            <li>
                                                <a href="#" target="_blank"><i class="fab fa-linkedin-in"></i></a>
                                            </li>
                                            <li>
                                                <a href="#" target="_blank"><i class="fab fa-instagram"></i></a>
                                            </li>
                                            <li>
                                                <a href="#" target="_blank"><i class="fab fa-dribbble"></i> </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-1">
                        </div>
                        <div class="col-lg-4 col-md-12">
                            <div class="footer-widget footer-contact">
                                <h2 class="footer-title">Liên hệ</h2>
                                <div class="footer-contact-info">
                                    <div class="footer-address">
                                        <span><i class="fas fa-map-marker-alt"></i></span>
                                        <p> 437c/4 Long Hòa, Bình Thủy, Cần Thơ</p>
                                    </div>
                                    <p>
                                        <i class="fas fa-phone-alt"></i>
                                        0977129155
                                    </p>
                                    <p class="mb-0">
                                        <i class="fas fa-envelope"></i>
                                        doccure@gmail.com
                                    </p>
                                </div>
                            </div>

                        </div>
                        <div class="col-lg-2 col-md-3">
                        </div>
                    </div>
                </div>
            </div>
        </footer>

        <!-- /Footer -->
    </div>

    <script src="/doc_assets/js/jquery.min.js"></script>
    <script src="~/doc_assets/js/moment.min.js"></script>
    <script src="~/doc_assets/js/bootstrap-datetimepicker.min.js"></script>
    <script src="~/doc_assets/js/fullcalendar.min.js"></script>
    <script>

        var j = jQuery.noConflict();
        var infos = null;
        var index = 0;
        j(document).ready(() => {
            infos = JSON.parse(localStorage.getItem('infos'));
            j.ajax({
                type: "GET",
                async: false,
                url: "/patient/home/getTimeRange",
                success: function (data) {
                    infos.timeRange = data;
                },
                error: function (error) {
                    console.log('get time range failed');
                }
            })
            j.ajax({
                type: "POST",
                async: false,
                data: null,
                url: "/patient/home/getRoom",
                success: function (data) {
                    infos.room = data;
                },
                error: function (error) {
                    console.log('get room failed');
                }
            })
            if (infos.info[index].dept) {
                j.ajax({
                    type: "POST",
                    url: '/patient/home/GetScheduleByDeptAndDate',
                    data: { dated: infos.info[index].dated, idDept: infos.info[index].dept.idDept },
                    success: function (d) {
                        console.log("Danh sach bac si", d);
                        if (d.length > 0) {
                            let str = '';
                            let s = infos.timeRange.filter((e) => e.idSes === 1).map((e) => e.idPeriod)
                            let c = infos.timeRange.filter((e) => e.idSes === 2).map((e) => e.idPeriod)
                            console.log("Buổi: ", s, c)
                            for (let x of d) {
                                j.ajax({
                                    url: '/patient/home/GetTimeRangeExceed',
                                    data: { dated: moment(infos.info[index].dated).format('DD/MM/YYYY'), idemp: x.idEmp },
                                    async: false,
                                    success: function (data) {
                                        let exceed = data.map((item, index) => { return item.idPeriod })
                                        console.log({ exceed })
                                        let sesion = ''
                                        let timeList = x.timeRange.split(',')
                                        if (timeList.some(r => s.includes(parseInt(r))) && timeList.some(r => c.includes(parseInt(r)))) {
                                            sesion = 'Cả ngày'
                                        } else if (timeList.some(r => s.includes(parseInt(r)))) {
                                            sesion = 'Buổi Sáng'
                                        } else {
                                            sesion = 'Buổi chiều'
                                        }
                                        let timeRangeName = '';
                                        for (let l of timeList) {
                                            let t = infos.timeRange.filter(x => x.idPeriod == l)[0]
                                            if (exceed.indexOf(parseInt(t.idPeriod)) < 0) {
                                                timeRangeName += `<li><a data-doctor='${JSON.stringify(x)}' onclick="setTimeRange(this,${t.idPeriod})" class="btn btn-outline-info set-time-range">${t.rangeTime}</a></li>`
                                            } else {
                                                timeRangeName += `<li><a data-doctor='${JSON.stringify(x)}'class="btn btn-secondary disabled set-time-range">${t.rangeTime}</a></li>`
                                            }
                                        }
                                        str += `<div class="brt-cont-group">
                                                <div class="brt-cont d-flex align-items-center" onclick="showTimeRange(this)"><i class="fas fa-angle-left"></i>
                                                    <span class="fas fas fa-user-md"></span>
                                                    <div class="brt-cont-right">
                                                        <div class="brt-cont-name">${x.eduName} - ${x.nameEmp}</div>
                                                        <div class="brt-cont-code">${infos.room.filter(y => y.ordinalRoom == x.ordinalRoom)[0].roomName} / ${sesion.toUpperCase()}</div>
                                                    </div>
                                                </div>
                                                <div class="brt-cont-hide d-none">
                                                    <ul>${timeRangeName}</ul>
                                                </div>
                                            </div>`
                                    }
                                })
                                document.getElementById('accordionExample').innerHTML = str;
                            }
                        }
                    }
                })

            }
            if (infos.patient) {
                document.getElementById('patientDetail').innerHTML = `<div class="blmt-name">
                                                                <div class="nav-title-name">${infos.patient?.namePatient}</div>
                                                            </div>
                                                            <div class="blmt-info">Địa chỉ: ${infos.patient?.addP}</div>
                                                            <div class="blmt-info">Điện thoại: ${infos.patient?.phone}</div>`
            }
            document.getElementById('doctorDetail').innerHTML = infos.info[index].dept
                ? `<h4 class="title1">THÔNG TIN KHÁM</h4>
                                                <ul>
                                                    <li class="circle"><i class="far fa-hospital"></i>BỆNH VIỆN TẬN TÂM</li>
                                                    <li class="circle"><i class="fas fa-file-medical"></i>${infos.info[index].dept.deptName}</li>
                                                    <li class="circle"><i class="fas fa-user-md"></i><span id=doctorInfo></span></li>
                                                    <li class="circle" id="datechoose"><i class="far fa-calendar-check"></i>Ngày khám: ${moment(infos.info[index].dated).format('DD/MM/YYYY')}</li>
                                                    <li class="circle" id="hourchoose"><i class="far fa-clock"></i>Giờ khám: </li>
                                                </ul>`
                : `Chưa có thông tin bác sĩ`;

        })
        function setTimeRange(e, id) {
            let settimerange = document.getElementsByClassName('set-time-range')
            for (x of settimerange) {
                x.classList.remove('btn-info')
                x.classList.remove('text-white')
                x.classList.remove('font-weight-bolder')
            }
            e.classList.add('btn-info')
            e.classList.add('text-white')
            e.classList.add('font-weight-bolder')
            infos.info[index].doctor = j(e).data('doctor');
            infos.info[index].timeChoose = id;
            document.getElementById('doctorInfo').innerHTML = `${infos.info[index].doctor.nameEmp}`
            document.getElementById('hourchoose').innerHTML = `<i class="far fa-clock"></i>Giờ khám: ${infos.timeRange.filter(x => x.idPeriod == id)[0].rangeTime}`;
        }
        function showTimeRange(e) {
            document.getElementById('doctorInfo').innerHTML = '';
            e.childNodes[0].classList.toggle('fa-angle-left');
            e.childNodes[0].classList.toggle('fa-angle-right');
            e.nextElementSibling.classList.toggle('d-none');
        }
        function next() {
            if (infos.info[index].doctor && infos.info[index].timeChoose) {
                localStorage.setItem('infos', JSON.stringify(infos));
                window.location.href = "/Patient/Home/ConfirmInfo";
            } else {
                alert('Bạn chưa chọn giờ khám')
            }
        }
    </script>
    @*<script src="/specialist/js/jquery.min.js"></script>*@

    <!--Bootstrap Core JS-->
    <script src="/specialist/js/popper.min.js"></script>
    <script src="/specialist/js/bootstrap.min.js"></script>

    <!-- Sticky Sidebar JS -->
    <script src="/specialist/plugins/theia-sticky-sidebar/ResizeSensor.js"></script>
    <script src="/specialist/plugins/theia-sticky-sidebar/theia-sticky-sidebar.js"></script>

    <!-- Datetimepicker JS -->
    <!--<script src="/specialist/js/moment.min.js"></script>
    <script src="/specialist/js/bootstrap-datetimepicker.min.js"></script>-->
    <!-- Full Calendar JS -->
    <!--<script src="/specialist/plugins/jquery-ui/jquery-ui.min.js"></script>
    <script src="/specialist/plugins/fullcalendar/fullcalendar.min.js"></script>
    <script src="/specialist/plugins/fullcalendar/jquery.fullcalendar.js"></script>-->
    <!-- Custom JS -->
    <script src="/specialist/js/script.js"></script>
</body>

<!-- doccure/calendar.html  30 Nov 2019 04:12:19 GMT -->
